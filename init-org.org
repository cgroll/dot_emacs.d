#+TITLE: Initialization of org-mode settings
#+OPTIONS: ^:nil
#+STARTUP: CONTENTS
#+BEGIN_COMMENT
Options: ^:nil avoids automatic subindex interpretation of
underscores.
#+END_COMMENT

* Set global key bindings
At first, we want to set the most important key bindings.
#+BEGIN_SRC emacs-lisp
(global-set-key "\C-cl" 'org-store-link)
(global-set-key "\C-cc" 'org-capture)
(global-set-key "\C-ca" 'org-agenda)
(global-set-key "\C-cb" 'org-iswitchb)
#+END_SRC

* Org-mode file formats
Automatically use org-mode for .org files, .txt files and org_archive
files.
#+BEGIN_SRC emacs-lisp
(add-to-list 'auto-mode-alist '("\\.\\(org\\|org_archive\\|txt\\)$" . org-mode)) 
#+END_SRC

* Org task manager
This chapter determines all customized settings for using org-mode as
task planer. The settings are chosen in compliance with the Getting
things done methodology.

** Determine files for org agenda
First, we have to define which files to use when searching for tasks.
In this setting, all paths in the /~/org/ directory are on the path
list, and the file used as inbox bucket for captured notes is set to
/~/org/refile.org/. In order to synchronize these files privately
over multiple computers, the complete /~/org/ directory is only a
symbolic link to a folder stored in my dropbox.
#+BEGIN_SRC emacs-lisp
  (setq org-agenda-files (quote ("~/org/todo.org")))
  (setq org-default-notes-file "~/org/refile.org") 
#+END_SRC
** Determine files for notes captured by org-mode
In addition to all files regarding my daily tasks and appointments, I
also use org-mode to capture short notes about things I read.
Especially, I collect short information about software and coding
tricks that I stumble upon, and capture them in my computational
science directory /~/comp_science/, where plain text files with notes
regarding to all different topics are stored. These files again are
publicly available through at git repository stored at github. So far,
my notes files are:
- bash_notes.org :: contains notes on bash programming and all
                    important commands for the linux shell
- emacs_notes.org :: notes about emacs installation procedures, as
     well as installation procedures for all emacs extensions. Also,
     the structure of my emacs configuration is explained, together
     with descriptions on keeping my emacsen as git repository for
     simple syncronization between multiple computers.
- git_notes.org :: notes on subversion control with git and github
                   (which is also how I backup my emacs system
                   settings publicly).
- gtd_notes.org :: more elaborate description of the structure and
                   possibilities of the org task managing features.
                   gtd refers to "Getting things done", which is a
                   book regarding a detailled task management
                   procedure.
- e_lisp_notes.org :: notes on emacs lisp
- e_wanderlust_notes.org :: wanderlust email notes
- e_bbdb_notes.org :: using big brother database
- R_notes.org :: notes on statistical computing with R
- matlab_notes.org :: notes on using matlab
- julia_notes.org :: notes on using julia language
- literature_notes.org :: notes on digital literature management -
     comprises mendeleydesktop, JabRef, Citavi, etc.
- e_latex_notes.org :: notes on latex, with focus on latex in emacs

The respective public git-repo should be easily forked, so that everybody can
extend it with private notes.

*Remark: all these files shall be available publicly, so that none of them may
contain any sensitive private data!!*

** Todo states
I keep the following todo states:
- TODO :: every individual task generally gets a TODO mark
- NEXT :: if any higher-level task or project brings forth any
          subtask, then this is marked as NEXT. This way I shift tasks
          from my external projects to my agenda, without immediately
          integrating the complete major project. Furthermore,
          long-term targets are forced to be splitted into minor
          tasks, which are much better to focus on.
- DONE :: the classic label for finished tasks
- WAITING :: if a task is still prevailing, but can not be processed
             right now since it depends on someone else's action.
             Could be used to indicate some chronological temporal
             dependency on a different task. However, chronological
             ordering at best should be implemented directly.
- CANCELLED :: any task that suddenly is not required anymore
- SOMEDAYS :: captures any unconcrete long-term targets or just things
              that probably would be nice to having it doing
*** State definitions
Entering any todo state automatically will create a timestamp. While
the timestamp for TODO and NEXT will be made at its creation, all
other states are told to log the entry time with a "!" sign in the
state definition. Additionally, WAITING and CANCELLED will call for a
note, so that an explanation can be added. Also, most states will log
exiting times as well. Fast access for todo states are guaranteed with
shortcut letters for each state, which also have to be enabled:
#+BEGIN_SRC emacs-lisp
  (setq org-use-fast-todo-selection t)
#+END_SRC
#+BEGIN_SRC emacs-lisp
  (setq org-todo-keywords
     (quote ((sequence "TODO(t)" "STEADY(s)" "HABIT(h)" "NEXT(n)" "|" "DONE(d!/!)")
               (sequence "WAITING(w@/!)" "|" "CANCELLED(c@/!)" "SOMEDAY(s!/!)"))))
#+END_SRC
Here I determine custom face colors for my task state keywords.
#+BEGIN_SRC emacs-lisp
  (setq org-todo-keyword-faces
     (quote (("TODO" :foreground "red" :weight bold)
               ("STEADY" :foreground "yellow")
               ("HABIT" :foreground "deep pink" :weight bold)
               ("NEXT" :foreground "blue" :weight bold)
               ("DONE" :foreground "forest green" :weight bold)
               ("WAITING" :foreground "orange" :weight bold)
               ("SOMEDAY" :foreground "spring green" :weight bold)
               ("CANCELLED" :foreground "sea green" :weight bold))))
#+END_SRC
When skipping through todo states for minor corrections with shift
key, log processing will be disabled. Otherwise we will get to many
timestamps.
#+BEGIN_SRC emacs-lisp
  (setq org-treat-S-cursor-todo-selection-as-state-change nil)
#+END_SRC

** Org-capture
The process of capturing tasks and notes is probably one of the most
important parts of the complete system. It is absolutely crucial to
the system that any information can be temporarily captured and shoved
away fast and without disturbing the current workflow. That means,
with very few shortcuts any information can be captured in a highly
adapted template tailored to the specific information requirements. At
a header level, information is classified as one of several main
topics:
- TODO task
- email response
- event, appointment, date
- note
At the second layer, more specific patterns are distinguished, like
storage location, prompts, tags and the like.
*** Capturing tasks
#+BEGIN_SRC emacs-lisp
  (setq org-capture-templates
        (quote (
                  ("t" "TASK: multiple templates")
                  
                  ; TODO entry, inactive timestamp, heading needs to be inserted, manual scheduling
                  ("tt" "task, manual scheduling"
                     entry (file+headline "~/org/refile.org" "tasks")
                     "* TODO %? \nAdded: %U\n"
                     :clock-in t :clock-resume t) 
                  
                  ;; TODO entry, inactive timestamp, prompt for tag, heading needs to be inserted 
                  ("tT" "task, tag prompt"
                     entry (file+headline "~/org/refile.org" "tasks")
                     "* TODO %? %^G \nAdded: %U\n"
                     :clock-in t :clock-resume t)
  
                  ;; Checklist entries to steady challenges
                  ("tc" "checkitem: COMPUTER improvements"
                     checkitem (file+headline "~/org/todo.org"
                     "Computational science" "Computer improvements")
                     " [ ] %?")
  
                  ("te" "checkitem: EMACS improvements"
                     checkitem (file+headline "~/org/todo.org"
                     "Computational science" "Emacs improvements")
                     " [ ] %?")
  
                  ("tk" "checkitem: KNOWLEDGE improvements"
                     checkitem (file+headline "~/org/todo.org"
                     "Education" "Knowledge improvements")
                     " [ ] %?") 
    
                  ;; TODO entry, inactive timestamp, prompt for yanking
                  ("ty" "task with yanking" entry (file+headline
                  "~/org/refile.org" "tasks") 
                     "* TODO %? %^G \nSCHEDULED: %t \n%^C\nAdded: %U\n"
                     :clock-in t :clock-resume t)
                  
                  ;; TODO entry, inactive timestamp, prompt for tag and clipboard entry
                  ("tY" "task with tag and yanking"
                     entry (file+headline "~/org/refile.org" "tasks")
                     "* TODO %? %^G \nSCHEDULED: %t \n%^C\nAdded: %U\n"
                     :clock-in t :clock-resume t)
                  
                  ;; New research project: create project heading in todo.org under research projects
                  ;; includes: link to file, timestamp, prompt for project tag as property %^{TAGS}p
                                          ; project related tasks with link to origin
                  ("tP" "project with tag, automatic source"
                     entry (file+headline "~/org/todo.org" "Research")
                     "* NEXT %? :%^{TAG?}: \nSCHEDULED: %t\n%a\nAdded: %U\n "
                     :clock-in t :clock-resume t)
  
                  
                  ("tp" "project task"
                     entry (file+headline "~/org/todo.org" "Research")
                     "* NEXT %? :%^{TAG?}: \nSCHEDULED: %t\nAdded: %U\n "
                     :clock-in t :clock-resume t)         
                  ;; write function to shift todo tasks from project file to agenda ! 
                  
                  ("r" "EMAIL response"
                     entry (file+headline "~/org/refile.org" "tasks")
                     "* TODO Respond to %:from on %:subject :EMAIL:\n%t\n%a\n"
                     :clock-in t :clock-resume t :immediate-finish t
                     )
                  
                  ("h" "HABIT"
                     entry (file+headline "~/org/refile.org" "tasks")
                     "* HABIT %?\n%U\nSCHEDULED: %t .+1d/3d\n
  :PROPERTIES:\n:STYLE: habit\n:REPEAT_TO_STATE: HABIT\n:END:\n")
  
                  )
           )
     )
#+END_SRC

*** Capturing events
#+BEGIN_SRC emacs-lisp
  (setq org-capture-templates  
(append org-capture-templates
     (quote (
               ("e" "Templates for events")
               
               ;; Future event: prompt for date without time
               ("ee" "daily event without time"
               entry (file+headline "~/org/refile.org" "tasks")
                  "* %? :calendar: \n%^{Which date?}t \nAdded:%U\n"
                  :clock-in t :clock-resume t)
               
               ;; Future event: prompt for date WITH time
               ("et" "event with time specification"
               entry (file+headline "~/org/refile.org" "tasks")
                  "* %? :calendar: \n%^{Which date and time?}T \nAdded: %U\n"
                  :clock-in t :clock-resume t)
  
               ;; Future event lasting for multiple days
               ("ed" "enduring event"
               entry (file+headline "~/org/refile.org" "tasks")
                  "* %? :calendar: \n%^{Starting time?}T--%^{Ending time?}T \nAdded: %U\n"
                  :clock-in t :clock-resume t)

               ;; Entry in tracking file
               ("eh" "tracking history event"
               entry (file+datetree "~/org/tracker.org")
                    "* %^{Activity?|haircut|handy_charge|dentist|grandparents} %?"
                    :clock-in t :clock-resume t)

               ;; Birthday entry into anniversaries calendar with prompt
               ;; for date; date is active -> appears in agenda
               ("ea" "annually repeating event"
               entry (file+headline "~/org/todo.org" "Anniversaries")
                  "%%(org-anniversary %?) %{Which event?} %d"
                  :clock-in t :clock-resume t)
               
               ;; Entry in log: at current time finished activity with completion
               ("el" "logbook: finished activities"
               entry (file+datetree "~/org/log.org")
                  "* %U - %^{Activity?|lunch|break|buy|program|read|work|research|torture} "
                  :clock-in t :clock-resume t)
               
               ;; Stopwatch activity without prompt
               ("es" "stopwatch"
               entry (file+datetree "~/org/log.org")
                  "* Stopwatch %? \nStarted: %U\n"
                  :clock-in t :clock-resume t)
               
               ;; Entry in creditcard with prompt for sum and cursor for item specification
               ("ec" "credit-card info"
               entry (file+datetree "~/org/creditcard.org")
                  "* %? - %^{Amount?} \nAdded: %U\n"
                  :clock-in t :clock-resume t)
               
               )
        )
     )
)
#+END_SRC

;; Capture templates for: TODO tasks, Notes, appointments, phone
calls, and org-protocol
*** Capturing desired products
#+BEGIN_SRC emacs-lisp
  (setq org-capture-templates  
(append org-capture-templates
     (quote (
               ("b" "BUY product: multiple templates")
    
               ;; append to shop list
               ("bs" "product from SHOP"
                  checkitem (file+olp "~/org/todo.org" "Buy" "Shop")
                  " [ ] %? ") 
    
               ;; append to mall list
               ("bm" "product from MALL"
                  checkitem (file+olp "~/org/todo.org" "Buy" "Mall")
                  " [ ] %? ") 
    
               ;; append to regular list
               ("br" "REGULAR product"
                  checkitem (file+olp "~/org/todo.org" "Buy" "Regulars")
                  " [ ] %? ") 
      
               )
        )
     )
)
#+END_SRC
*** Capturing notes
Plain notes without any code, yanking or source file link.
#+BEGIN_SRC emacs-lisp
  (setq org-capture-templates
       (append org-capture-templates
          (quote (
                    ;; notes without code or yanking
                    ;("n" "Plain notes without code or yanking")
    
                    ;; git-note
                    ("n" "plain note"
                       entry (file+headline "~/org/refile.org" "notes")
                       "* %? ")
  
                    ("N" "note with yanking"
                       entry (file+headline "~/org/refile.org" "notes")
                       "* %? \n%^C")
  
                    
                    ("o" "note with origin and yanking"
                       entry (file+headline "~/org/refile.org" "notes")
                       "* %? \nFrom: %A\n%^C")
  
                    ("s" "shortcut"
                         table-line (file+headline "~/org/refile.org" "shortcuts")
                         "| %? | |")
                    
                    ("S" "shortcut with yanking"
                         table-line (file+headline "~/org/refile.org" "shortcuts")
                         "| ^C | |")
    
                    )
             )
          )
)
    
#+END_SRC
Notes with code snippet in clipboard or kill ring, and source file link.
#+BEGIN_SRC emacs-lisp
  (setq org-capture-templates       
(append org-capture-templates
          (quote (
                    ;; code yanking
                    ("c" "note with code"
                       entry (file+headline "~/org/refile.org" "notes")
                       "* %? \n#+begin_src
                    %^{Language?|emacs-lisp|sh|matlab|r|julia} \n%^C\n#+end_src \n")
  
                    ;; code yanking with source recording for w3m
                    ("w" "note with code, source "
                       entry (file+headline "~/org/refile.org" "notes")
                       "* %? \n#+begin_src
                    %^{Language?|emacs-lisp|sh|matlab|r|julia} \n%^C\n#+end_src \n%a\n")
             )
          )
       )
)      
#+END_SRC
Additional notes to store:
- emacs command / with shortcut / explanation
- track things:
  - vacation days / costs
  - handy balance
- registration / password
*** Capturing bibtex entries
#+BEGIN_SRC emacs-lisp
  (setq org-capture-templates
     (append org-capture-templates
        (quote (
                  ("b" "BIBTEX entry"
                     entry
                     (file+headline "~/literature/management/bibliography.org" "unsorted entries")
                     "* %:title   %^G
    :PROPERTIES:
    :author: %:author
    :year: %:year
    :journal: %:journal
    :Bibtex key: %:key
    :link to bibtex entry: %a 
    :link to pdf: [file:~/literature/%:author_%:year.pdf]
    :link to notes: [file:~/literature/notes/%:author_%:year.org]
    :entered: %U
    :END:
    Comment: %?
    " :empty-lines 2)
                  )
           )
        )
     )
  
#+END_SRC
*** Capturing present ideas
#+BEGIN_SRC emacs-lisp
  (setq org-capture-templates
     (append org-capture-templates
        (quote (
                  ("p" "PRESENT idea"
                     checkitem
                     (file+headline "~/org/todo.org" "Presents")
                     " [ ] %? " :prepend)
                  )
           )
        )
     )
  
#+END_SRC
*** Refile targets
#+BEGIN_SRC emacs-lisp  (setq org-refile-use-outline-path t)
  (setq org-refile-use-outline-path 'file)
  (setq org-outline-path-complete-in-steps t)
  (setq org-refile-allow-creating-parent-nodes (quote confirm))
  ;; (setq org-completion-use-ido t)
  ;; (setq ido-everywhere t)
  ;; (setq ido-max-directory-size 100000)
  ;; (ido-mode (quote both))
#+END_SRC

#+BEGIN_SRC emacs-lisp
  ;; (setq org-refile-targets
  ;;    (quote
  ;;       (("~/comp_science/bash_notes.org" :maxlevel . 4)
  ;;          ;;(nil :maxlevel . 3)          
  ;;          ;;(org-agenda-files :maxlevel . 4)
  
  ;;          ("~/comp_science/e_auto-complete_notes.org" :maxlevel . 4)         
  ;;          ("~/comp_science/emacs_notes.org" :maxlevel . 4)
  ;;                   
  ;;          
  ;;          
  ;;          )
  ;;       )
  ;;    )
  
  
  ;; refile targets
  (setq org-refile-targets
     (quote
        (("~/org/todo.org" :maxlevel . 1)
           ("~/org/log.org" :maxlevel . 1)
           ("~/org/creditcard.org" :maxlevel . 1)
           ("~/comp_science/e_auto-complete_notes.org" :maxlevel . 3)
           ("~/comp_science/emacs_notes.org" :maxlevel . 3)
           ("~/comp_science/git_notes.org" :maxlevel . 3)
           ("~/comp_science/gtd_notes.org" :maxlevel . 3)
           ("~/comp_science/ubuntu_notes.org" :maxlevel . 3)
           ("~/org/annuals.org" :maxlevel . 1))))
  ;; (defun cg/org-refile ()
  ;;    (interactive)
  ;;    (add-file-local-variable 'org-refile-targets t)
  ;;    (setq org-refile-targets
  ;;       (quote
  ;;          (("~/org/todo.org" :maxlevel . 1)
  ;;             ("~/org/log.org" :maxlevel . 1)
  ;;             ("~/org/creditcard.org" :maxlevel . 1)
  ;;             ("~/org/annuals.org" :maxlevel . 1))))
  ;;    )
#+END_SRC


** Org-agenda
Restore window settings as they were before the call of org-agenda.
#+BEGIN_SRC emacs-lisp
  (setq org-agenda-restore-windows-after-quit t)
#+END_SRC
Agenda-view:
#+BEGIN_SRC emacs-lisp  
  (setq org-agenda-todo-ignore-scheduled t)
  (setq org-agenda-todo-ignore-deadlines t)
  (setq org-agenda-todo-ignore-timestamp 'all)
#+END_SRC
** OrgMobile
#+BEGIN_SRC emacs-lisp
  (setq org-mobile-directory "~/Dropbox/MobileOrg")
#+END_SRC

** Customize variables
#+BEGIN_SRC emacs-lisp
  (custom-set-variables
     '(org-agenda-ndays 14)
     '(org-deadline-warning-days 14)
     '(org-agenda-show-all-dates t)
     '(org-agenda-skip-deadline-if-done t)
     '(org-agenda-skip-scheduled-if-done t)
     '(org-agenda-start-on-weekday nil) ; start agenda at current day
     '(org-reverse-note-order nil) ; append new nodes
     '(org-fast-tag-selection-single-key nil) ; you have to press RET to exit tag menu 
     )
  (org-babel-do-load-languages
     'org-babel-load-languages
     '((emacs-lisp . t)
         (latex . t)
         (sh . t)
         (R . t)))
  
#+END_SRC
(org-agenda-custom-commands
   (quote (("d" todo "DELEGATED" nil)
       ("c" todo "DONE|DEFERRED|CANCELLED" nil)
       ("w" todo "WAITING" nil)
       ("W" agenda "" ((org-agenda-ndays 21)))
       ("A" agenda ""
        ((org-agenda-skip-function
          (lambda nil
        (org-agenda-skip-entry-if (quote notregexp) "\\=.*\\[#A\\]")))
         (org-agenda-ndays 1)
         (org-agenda-overriding-header "Today's Priority #A tasks: ")))
       ("u" alltodo ""
        ((org-agenda-skip-function
          (lambda nil
        (org-agenda-skip-entry-if (quote scheduled) (quote deadline)
                      (quote regexp) "\n]+>")))
         (org-agenda-overriding-header "Unscheduled TODO entries: ")))))
<<<<<<< HEAD

* Org babel
Disable confirmation query for code evaluation and evaluation on export.
#+BEGIN_SRC emacs-lisp
  (setq org-confirm-babel-evaluate nil)
  (setq org-export-babel-evaluate nil)
#+END_SRC

Load languages.
#+BEGIN_SRC emacs-lisp
 (org-babel-do-load-languages
     'org-babel-load-languages
     '((emacs-lisp . nil)
         (R . t)
         (matlab . t)
         (sh . t)))
#+END_SRC

Open edit-src-block in same window.
#+BEGIN_SRC emacs-lisp
  (setq org-src-window-setup 'current-window)
#+END_SRC
